/*******************************************************************************
 * Copyright 2024 Stefan Holm
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
package ch.wsl.sustfor.lang;

/**
 * 
 * @author Stefan Holm
 *
 */
public class SorSimLanguageManager {
	
	//menu
	public final String mnuDatei = "mnuDatei";
	public final String mnuStandardModus = "mnuStandardModus";
	public final String mnuExtendedModus = "mnuExtendedModus";
	public final String mnuBeenden = "mnuBeenden";
	public final String mnuHilfe = "mnuHilfe";
	public final String mnuInfo = "mnuInfo";
	public final String mnuTools = "mnuTools";
	public final String mnuSvListeBearbeiten = "mnuSvListeBearbeiten";
	public final String mnuBaumartenListeAnzeigen = "mnuBaumartenListeAnzeigen";
	public final String mnuHandbuch = "mnuHandbuch";
	
	//mainwindow
	public final String lblOptionen = "lblOptionen";
	public final String lblSprachcode = "lblSprachcode";
	public final String lblSchaftformFkt = "lblSchaftformFkt";
	public final String lblNachkommastellen = "lblNachkommastellen";	
	public final String btnSortimentStueckInBsEinpassen = "btnSortimentStueckInBsEinpassen";
	public final String btnSortimentsTabelleErstellen = "btnSortimentsTabelleErstellen";
	public final String btnBaumlisteSortimentieren = "btnBaumlisteSortimentieren";
	public final String lblGewaehlteSchaftformFkt = "lblGewaehlteSchaftformFkt";
	public final String lblCode_Baumart = "lblCode_Baumart";
	
	//sortimentstueck in bs einpassen
	public final String lblBaumschaft = "lblBaumschaft";
	public final String lblSchaftdefinition = "lblSchaftdefinition";
//	public final String lblMesshoeheAmSchaftObererDrm_m = "lblMesshoeheAmSchaftObererDrm_m";
//	public final String lblMesshoeheAmSchaftUntererDrm_m = "lblMesshoeheAmSchaftUntererDrm_m";
	public final String lblObererDrmIR_cm = "lblObererDrmIR_cm";
	public final String lblUntererDrm_IR_cm = "lblUntererDrm_IR_cm";
	public final String lblAushalteStrategie = "lblAushalteStrategie";
	public final String lblPositionierung = "lblPositionierung";
	public final String lblIntervall_m = "lblIntervall_m";
	public final String lblMin = "lblMin";
	public final String lblMax = "lblMax";
	public final String lblPosAmStamm = "lblPosAmStamm";
	public final String lblLaenge_m = "lblLaenge_m";
	public final String lblMiDrm_cm = "lblMiDrm_cm";
	public final String lblZopfDrm_cm = "lblZopfDrm_cm";
	public final String lblBerechnungStarten = "lblBerechnungStarten";
	public final String lblHoeheAutomatischBerechnen = "lblHoeheAutomatischBerechnen";
	public final String lblHoeheAutomatischBerechnenExt = "lblHoeheAutomatischBerechnenExt";
	public final String lblGrundflächenmittelstamm = "lblGrundflächenmittelstamm";
	public final String lblHoeheGrundflaechenmittelstamm = "lblHoeheGrundflaechenmittelstamm";
	
	//Sortimentstabelle erstellen
	public final String lblBaeume = "lblBaeume";
	public final String lblMindestZopf_cm = "lblMindestZopf_cm";
	public final String lblVon = "lblVon";
	public final String lblBis = "lblBis";
	public final String lblBHD_cm = "lblBHD_cm";
	
	//Baumliste sortimentieren
	public final String lblBaumliste = "lblBaumliste";
	public final String lblBaumlistenFile = "lblBaumlistenFile";
	public final String lblQualitaet = "lblQualitaet";
	public final String lblSortimentsVorgabenFile = "lblSortimentsVorgabenFile";
	public final String lblKriterium = "lblKriterium";
	public final String lblReihenfolge = "lblReihenfolge";
	public final String lblWeitereSortierbedingungen = "lblWeitereSortierbedingungen";
	public final String lblMindestZopf_cm_ext = "lblMindestZopf_cm_ext";
	public final String lblPruefschrittweite = "lblPruefschrittweite";
	public final String lblDarstellungErgebnisse = "lblDarstellungErgebnisse";
	public final String lblSortimentsStuecklistenFile = "lblSortimentsStuecklistenFile";
	public final String lblErstellteSortimenteInAusgabeDateiSchreiben = "lblErstellteSortimenteInAusgabeDateiSchreiben";
	public final String lblDateiAuswaehlen = "lblDateiAuswaehlen";
	public final String lblDoppelKlickZumOeffnen = "lblDoppelKlickZumOeffnen";
	public final String lblSchaftanteilBerechnen = "lblSchaftanteilBerechnen";
	
	//PanelBäume
	public final String lblD7m_cm = "lblD7m_cm";
	public final String lblD7mBHDRelation = "lblD7mBHDRelation";
	public final String lblStandortGut = "lblStandortGut";
	public final String lblStandortMager = "lblStandortMager";
	
	//PanelBaumliste
	public final String lblD7mBHDRelationExt = "lblD7mBHDRelationExt";
	
	//PanelDarstellungErgebnisse
	public final String lblZieldatei = "lblZieldatei";
	
	//PanelErgebnis
	public final String lblZusammenfassungErgebnis = "lblZusammenfassungErgebnis";
	public final String lblGesamtwert = "lblGesamtwert";
	public final String lblGesamtvolumenORm3 = "lblGesamtvolumenORm3";
	public final String lblAnzahlSortimente = "lblAnzahlSortimente";
	public final String lblStueckvolumen = "lblStueckvolumen";
	
	//PanelSortimentsvorgaben
	public final String lblImmerFolgendenMindestzopfVerwenden_cm = "lblImmerFolgendenMindestzopfVerwenden_cm";
	public final String lblImmerFolgendeStockhoeheVerwenden_cm = "lblImmerFolgendeStockhoeheVerwenden_cm";
	
	//Mehrfache benutzte
	public final String lblBaumartCode = "lblBaumartCode";
	public final String lblZuVerwendenderSchaftanteil = "lblZuVerwendenderSchaftanteil";
	public final String lblSchaftlaenge_m = "lblSchaftlaenge_m";
	public final String lblSortimentsVorgaben = "lblSortimentsVorgaben";
	public final String lblLaengenklasenKuerzel = "lblLaengenklasenKuerzel";
	public final String lblErgebnis = "lblErgebnis";
	public final String lblSortimentieren = "lblSortimentieren";
	public final String lblBitteWarten = "lblBitteWarten";
	public final String lblInfo = "lblInfo";
	public final String lblLaden = "lblLaden";
	public final String lblSpeichern = "lblSpeichern";
	
	//output-file
	public final String titleId = "titleId";
	public final String titleBaumId = "titleBaumId";
	public final String titleBaumart = "titleBaumart";
	public final String titleBaumartCode = "titleBaumartCode";
	public final String titleBeschriebBaumNr = "titleBeschriebBaumNr";
//	public final String titleAufnahmeDatum = "titleAufnahmeDatum";
	public final String titleStratifizierungsMerkmal = "titleStratifizierungsMerkmal";
	public final String titleBHD = "titleBHD";
	public final String titleSchaftlaenge = "titleSchaftlaenge";
	public final String titleLaengenklasse = "titleLaengenklasse";
	public final String titleStaerkenklasse = "titleStaerkenklasse";
	public final String titlePosBasisAmStamm_m = "titlePosBasisAmStamm_m";
	public final String titleLaenge_m = "titleLaenge_m";
	public final String titleBasisDrmOR = "titleBasisDrmOR";
	public final String titleMiDrmOR_cm = "titleMiDrmOR_cm";
	public final String titleZopfDrmOR_cm = "titleZopfDrmOR_cm";
	public final String titleVolumenOR_m3 = "titleVolumenOR_m3";
	public final String titleVolumenIR_m3 = "titleVolumenIR_m3";
	public final String titleVolRestStkUntenOR_m3 = "titleVolRestStkUntenOR_m3";
	public final String titleVolRestStkObenOR_m3 = "titleVolRestStkObenOR_m3";
	public final String titleQualitaet = "titleQualitaet";
	public final String titleWert_CHF = "titleWert_CHF";
	public final String titleAnzahl = "titleAnzahl";
	public final String titleSumme = "titleSumme";
	
	//Sortimentsvorgaben-File
	public final String titleAnzahlStueck = "titleAnzahlStueck";
	public final String titleLaengeMin_m = "titleLaengeMin_m";
	public final String titleLaengeMax_m = "titleLaengeMax_m";
	public final String titleMittenDrmMin_cm = "titleMittenDrmMin_cm";
	public final String titleMittenDrmMax_cm = "titleMittenDrmMax_cm";
	public final String titleZopfDrmMin_cm = "titleZopfDrmMin_cm";
	public final String titleZopfDrmMax_cm = "titleZopfDrmMax_cm";
	public final String titleLaengenZugabe_cm = "titleLaengenZugabe_cm";
	public final String titleLaengenZugabe_Prozent = "titleLaengenZugabe_Prozent";
	public final String titlePositionAmStammUnten_m = "titlePositionAmStammUnten_m";
	public final String titlePositionAmStaummOben_m = "titlePositionAmStaummOben_m";
	public final String titleLaengenIntervall_m = "titleLaengenIntervall_m";
	public final String titleAushaltestrategie = "titleAushaltestrategie";
	public final String titlePositionierung = "titlePositionierung";
	public final String titleWertA = "titleWertA";
	public final String titleWertB = "titleWertB";
	public final String titleWertC = "titleWertC";
	public final String titleWertD = "titleWertD";
	public final String titleAnteilA = "titleAnteilA";
	public final String titleAnteilB = "titleAnteilB";
	public final String titleAnteilC = "titleAnteilC";
	public final String titleAnteilD = "titleAnteilD";
	public final String titleWertProEinheit = "titleWertProEinheit";
	
	//Fehlermeldungen
	public final String errFehler = "errFehler";
	public final String errFehlerBeimOeffnenDerDatei = "errFehlerBeimOeffnenDerDatei";
	public final String errDateiSchreibFehler = "errDateiSchreibFehler";
	public final String errNumberInputVerifier1 = "errNumberInputVerifier1";
	public final String errNumberInputVerifier2 = "errNumberInputVerifier2";
	public final String errNumberInputVerifier3 = "errNumberInputVerifier3";
	public final String errKeineSortimenteErstellt = "errKeineSortimenteErstellt";
	public final String errSummeNicht100 = "errSummeNicht100";
	
	//Diverse
	public final String lblBaumartenliste = "lblBaumartenliste";
	public final String lblRestholz = "lblRestholz";
	public final String lblOben = "lblOben";
	public final String lblUnten = "lblUnten";
	
	//SvListeBearbeiten
	public final String lblSvListeBearbeiten = "lblSvListeBearbeiten";
	public final String lblSvListeAnmerkungen = "lblSvListeAnmerkungen";
	public final String errDateiNichtGeschriebenSummeNicht1 = "errDateiNichtGeschriebenSummeNicht1";
	
	private LanguageManager lang;
	private static SorSimLanguageManager instance = null;
	
	private SorSimLanguageManager() {
		lang = new LanguageManager();
		setActiveLanguage("de");
//		lang.addEntriesFromFile("res/lang_Sortimentierer.csv");
		lang.addEntriesFromFile("res/lang_sorsim_labels.csv");		
	}
	
	public static SorSimLanguageManager getInstance() {
		if (instance == null) {
			instance = new SorSimLanguageManager();
		}
		return instance;
	}
	
	/**
	 * Returns the text of the given field in the currently active language.
	 * 
	 * @param fieldName
	 * @return text or null, if field is not found or active language is null
	 */
	public String getText(String fieldName) {
		return lang.getText(fieldName);	
	}
	
	/**
	 * Returns the text of the given field in the currently active language.
	 * If the length of the text is longer than maxColumnLength, html-tags
	 * are added to text and line breaks are inserted in order that one line
	 * of text is not longer than maxColumnLength.
	 * 
	 * The text is formatted with the following html-tags:
	 * \<html\>\<center\>...\<br\>...\<br\>..\</center\>\</html\>
	 * 
	 * 
	 * @param fieldName
	 * @param maxColumnLength
	 * @return text or null, if field is not found or active language is null
	 */
	public String getText(String fieldName, int maxColumnLength, boolean alignCenter) {		
		//get text
		String text = getText(fieldName);
		if (text == null) {
			return null;
		}
		
		//insert line breaks
		String lineBreakTag = "<br>";		
		int firstPos = 0;
		int lastPos = maxColumnLength;
		int posLineBreak = -1;
		
		while (lastPos < text.length()) {
			int posSpace = firstPos + text.substring(firstPos, lastPos).lastIndexOf(" "); //look for a space
			int posHyphen = firstPos + text.substring(firstPos, lastPos).lastIndexOf("-"); //look for a hyphen

			posLineBreak = Math.max(posSpace, posHyphen); //look for last possible occurence of a space or a hyphen

			if (posLineBreak <= firstPos) {
				posLineBreak = lastPos; //if neither space nor hyphen found, break at last possible char
			}

			text = text.substring(0, posLineBreak) + lineBreakTag + text.substring(posLineBreak, text.length()); //insert line break tag

			firstPos = posLineBreak + lineBreakTag.length();
			lastPos  = firstPos + maxColumnLength;
		}
		
		if (alignCenter) {
			return "<html><center>" + text + "</center></html>";			
		}
		return "<html>" + text + "</html>";		
	}
	
	public void setActiveLanguage(String languageCode) {
		lang.setActiveLanguage(languageCode);
	}
	
	public String getActiveLanguage() {
		return lang.getActiveLanguage();
	}

	public AutoText getAutoText(String fieldName) {
		return new AutoText(fieldName);
	}
	
	public class AutoText {		
		private String myLabel;
		
		private AutoText(String myLabel) {
			this.myLabel = myLabel;
		}
		
		@Override
		public String toString() {
			return getText(myLabel);
		}
		
		@Override
		public boolean equals(Object other) {
			if (other == null || !(other instanceof AutoText) ) {
				return false;
			} else {				
				return ((AutoText)other).myLabel.equals(this.myLabel);
			}
		}
		
		@Override
		public int hashCode() {
			return myLabel.hashCode();
		}
	}
}
